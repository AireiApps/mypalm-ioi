<ion-header>
  <ion-toolbar class="bg-brown-color">
    <ion-buttons slot="start">
      <ion-back-button color="whitefav"></ion-back-button>
    </ion-buttons>
    <ion-title color="light">Corrective Maintenance - Response</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="savecorrectivemaintenanceForm">
    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Main System <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_mainsystem" placeholder="Main System" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Work Order No <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_workorderno" placeholder="Work Order No" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>PTW No <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_ptwno" placeholder="PTW No" class="h7 form-control text-dark"/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>SAP No <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_sapno" placeholder="SAP No" class="h7 form-control text-dark"/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Issued On <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_issuedon" placeholder="Issued On" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Urgency <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_urgency" placeholder="Urgency" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Type <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_type" placeholder="Type" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Zone <sup>*</sup></b>
        </div>
      </div>
    </div>

    <ion-row class="form-row">
      <ion-col size="11">
        <input type="text" formControlName="txt_zone" placeholder="Zone" class="h7 form-control text-dark readonly" readonly/>
      </ion-col>
      <ion-col size="1">
        <ion-checkbox style="vertical-align: middle;" (ionChange)="isZoneChecked($event)"></ion-checkbox>
      </ion-col>
    </ion-row>

    <!-- <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_zone" placeholder="Zone" class="h7 form-control text-dark readonly" value="{{zone}}" readonly/>
      </div>
    </div> -->

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Station <sup>*</sup></b>
        </div>
      </div>
    </div>

    <ion-row class="form-row">
      <ion-col size="11">
        <input type="text" formControlName="txt_station" placeholder="Station" class="h7 form-control text-dark readonly" readonly/>
      </ion-col>
      <ion-col size="1">
        <ion-checkbox style="vertical-align: middle;" (ionChange)="isStationChecked($event)"></ion-checkbox>
      </ion-col>
    </ion-row>

    <!-- <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_station" placeholder="Station" class="h7 form-control text-dark readonly" value="{{station}}" readonly/>
      </div>
    </div> -->

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Machinery <sup>*</sup></b>
        </div>
      </div>
    </div>

    <ion-row class="form-row">
      <ion-col size="11">
        <input type="text" formControlName="txt_machinery" placeholder="Machinery" class="h7 form-control text-dark readonly" readonly/>
      </ion-col>
      <ion-col size="1">
        <ion-checkbox style="vertical-align: middle;" (ionChange)="isMachineryChecked($event)"></ion-checkbox>
      </ion-col>
    </ion-row>

    <!-- <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_machinery" placeholder="Machinery" class="h7 form-control text-dark readonly" value="{{machinery}}" readonly/>
      </div>
    </div> -->

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Location ID <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_locationid" placeholder="Location ID" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Previous Maintenance On <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_previousmaintenanceon" placeholder="Previous Maintenance On" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Next Maintenance On <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_nextmaintenanceon" placeholder="Next Maintenance On" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div *ngIf="previousrunninghour!=''">
      <div class="form-row">
        <div class="col">
          <div class="h7 text-dark">
            <b>Previous Running Hour <sup>*</sup></b>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="col">
          <input type="text" formControlName="txt_previousrunninghour" placeholder="Previous Running Hour" class="h7 form-control text-dark readonly" readonly/>
        </div>
      </div>
    </div>

    <div *ngIf="currentrunninghour!=''">
      <div class="form-row">
        <div class="col">
          <div class="h7 text-dark">
            <b>Current Running Hour <sup>*</sup></b>
          </div>
        </div>
      </div>
      
      <ion-row class="form-row">
        <ion-col size="11">
          <input type="text" formControlName="txt_currentrunninghour" placeholder="Current Running Hour" class="h7 form-control text-dark readonly" readonly/>
        </ion-col>
        <ion-col size="1">
          <ion-checkbox style="vertical-align: middle;" (ionChange)="isCurrentRunningHourChecked($event)"></ion-checkbox>
        </ion-col>
      </ion-row>
    </div>

    <!-- <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_currentrunninghour" placeholder="Current Running Hour" class="h7 form-control text-dark readonly" value="{{currentrunninghour}}" readonly/>
      </div>
    </div> -->

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Total Running Hour <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_totalrunninghour" placeholder="Total Running Hour" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <ion-row class="form-row">
      <ion-col size="11">
        <div class="h7 text-dark">
          <b>Reset Machine Running Hour</b>
        </div>        
      </ion-col>
      <ion-col size="1">
        <ion-checkbox style="vertical-align: middle;" (ionChange)="isMachineRunningHourChecked($event)"></ion-checkbox>
      </ion-col>
    </ion-row>

    <hr>

    <div class="h7" style="text-align: center; color: #E53327;">
      <b>Part(s)</b>
    </div>

    <div>
      <ion-row>
        <div class="card gedf-card margin-bottom" *ngFor="let option of partsArr" style="width: 100%; margin: 0px 10px 10px 10px">
        <div class="card-header" style="text-align: center">
          <div class="h7 text-danger"><b>WON: {{workorderno}}</b>
            <ion-checkbox style="vertical-align: middle;float: right;" value="option" (click)="onChange(option.id)" name="option"></ion-checkbox>
          </div>          
        </div>
        <div style="margin: 10px 5px 10px 5px;">
          <div class="h7 text-dark" *ngIf="option.part!=''"><b>Part:</b> {{option.part}}</div>
          <div class="h7 text-dark" *ngIf="option.observation!=''"><b>Observation:</b> {{option.observation}}</div>
          <div class="h7 text-dark" *ngIf="option.possiblecauses!=''"><b>Possible Cause:</b> {{option.possiblecauses}}</div>
          <div class="h7 text-dark" *ngIf="option.actiontaken!=''"><b>Action Taken:</b> {{option.actiontaken}}</div>
          <div class="h7 text-dark" *ngIf="option.resetpartrunninghour!=''"><b>Reset Part Running Hours:</b> {{option.resetpartrunninghour}}</div>
          <div class="h7 text-dark" *ngIf="option.replacedpart!=''"><b>Replaced Part:</b> {{option.replacedpart}}</div>

          <ion-row class="row-reverse">
            <button type="button" class="h7 btn btn-outline-success btn-sm margin-5px" (click)="callmodalcontroller(option)">           
              Update
            </button>              
          </ion-row>
        </div>
      </div>
      </ion-row>
    </div>

    <hr>

    <div class="h7" style="text-align: center; color: #E53327;">
      <b>Work Progress</b>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Started On</b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_startedon" placeholder="Started On" class="h7 form-control text-dark readonly" readonly/>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Completed On <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <ion-datetime
          class="h7 form-control"
          formControlName="txt_completedon"
          placeholder="DD-MM-YYYY HH:mm"
          display-format="DD-MM-YYYY HH:mm"
          [min]="mindate"
          (ngModelChange)="onCompletedOnChange()"
        ></ion-datetime>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Duration</b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <input type="text" formControlName="txt_duration" placeholder="Duration" class="h7 form-control text-dark readonly" value="{{duration}}" readonly/>
      </div>
    </div>

    <div class="form-row imgmarigin">
      <label class="h7 text-dark"><b>Rectified Image <sup>*</sup></b></label>
      <div class="container">
        <div class="row">
          <div class="col-sm-8 nopadding" style="text-align: right">
            <div class="imagePreview" *ngIf="imagePaths.rectifiedimagepath == ''"></div>
            <div class="imagePresent" *ngIf="imagePaths.rectifiedimagepath != ''">
              <img class="imagePresent" [src]="imagePaths.rectifiedimagepath"/>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-4 nopadding" style="text-align: right">
            <label class="btn btn-warning">
              Upload<input
                  type="button"
                  class="uploadFile img"
                  value="Upload Photo"
                  style="width: 0px; height: 0px; overflow: hidden; display: none"
                  (click)="presentActionSheet('RectifiedImage')"
                />
            </label>
          </div>
        </div>
      </div>
    </div>
    
    <div class="form-row">
      <div class="col">
        <div class="h7 text-dark">
          <b>Work Status <sup>*</sup></b>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col">
        <select formControlName="select_workstatus" class="h7 text-dark form-control">
          <option value="" selected disabled hidden>Select Work Status</option>
          <option value="{{parseString(value)}}" *ngFor="let value of workstatusArr">
            {{ value.workstatus }}
          </option>
        </select>
      </div>
    </div>

    <ion-row style="margin-top: 10px;" *ngIf="partsArr.length > 0">
      <ion-col style="text-align: center;">
        <button type="submit" class="btn btn-info" (click)="save()">
          Save
        </button>
      </ion-col>
    </ion-row>
  </form>
</ion-content>
